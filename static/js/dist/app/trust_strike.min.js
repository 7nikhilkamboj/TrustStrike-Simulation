function errorFlash(e){$("#flashes").empty(),$("#flashes").append('<div style="text-align:center" class="alert alert-danger">        <i class="fa fa-exclamation-circle"></i> '+e+"</div>")}function successFlash(e){$("#flashes").empty(),$("#flashes").append('<div style="text-align:center" class="alert alert-success">        <i class="fa fa-check-circle"></i> '+e+"</div>")}function errorFlashFade(e,t){$("#flashes").empty(),$("#flashes").append('<div style="text-align:center" class="alert alert-danger">        <i class="fa fa-exclamation-circle"></i> '+e+"</div>"),setTimeout((function(){$("#flashes").empty()}),1e3*t)}function successFlashFade(e,t){$("#flashes").empty(),$("#flashes").append('<div style="text-align:center" class="alert alert-success">        <i class="fa fa-check-circle"></i> '+e+"</div>"),setTimeout((function(){$("#flashes").empty()}),1e3*t)}function modalError(e){var t="An error occurred";"string"==typeof e?t=e:e&&e.responseJSON&&e.responseJSON.message?t=e.responseJSON.message:e&&e.responseText&&(t=e.responseText),Swal.fire({title:"Error",text:t,icon:"error",confirmButtonText:"OK",buttonsStyling:!1,confirmButtonClass:"btn btn-danger",customClass:{confirmButton:"btn btn-danger"}})}function query(e,t,n,r){return $.ajax({url:"/api"+e,async:r,method:t,data:JSON.stringify(n),dataType:"json",contentType:"application/json",beforeSend:function(e){"undefined"!=typeof csrf_token&&e.setRequestHeader("X-CSRF-Token",csrf_token)}})}function escapeHtml(e){return $("<div/>").text(e).html()}function unescapeHtml(e){return $("<div/>").html(e).text()}window.escapeHtml=escapeHtml;var capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},api={campaigns:{get:function(e){return query("/campaigns/"+(e=e||""),"GET")},post:function(e){return query("/campaigns/","POST",e)},summary:function(e){return query("/campaigns/summary"+(e=e||""),"GET")}},sms_campaigns:{get:function(e){return query("/sms_campaigns/"+(e=e||""),"GET")},post:function(e){return query("/sms_campaigns/","POST",e)}},campaignId:{get:function(e){return query("/campaigns/"+e,"GET")},delete:function(e){return query("/campaigns/"+e,"DELETE")},results:function(e){return query("/campaigns/"+e+"/results","GET")},complete:function(e){return query("/campaigns/"+e+"/complete","GET")},summary:function(e){return query("/campaigns/"+e+"/summary","GET")}},groups:{get:function(){return query("/groups/","GET")},post:function(e){return query("/groups/","POST",e)},summary:function(){return query("/groups/summary","GET")},bulk_import_confirm:function(e){return query("/import/group/bulk_confirm","POST",e).done((function(){pollActiveJobs()}))}},groupId:{get:function(e){return query("/groups/"+e,"GET")},put:function(e){return query("/groups/"+e.id,"PUT",e)},delete:function(e){return query("/groups/"+e,"DELETE")}},templates:{get:function(){return query("/templates/","GET")},post:function(e){return query("/templates/","POST",e)}},templateId:{get:function(e){return query("/templates/"+e,"GET")},put:function(e){return query("/templates/"+e.id,"PUT",e)},delete:function(e){return query("/templates/"+e,"DELETE")}},pages:{get:function(){return query("/pages/","GET")},post:function(e){return query("/pages/","POST",e)}},pageId:{get:function(e){return query("/pages/"+e,"GET")},put:function(e){return query("/pages/"+e.id,"PUT",e)},delete:function(e){return query("/pages/"+e,"DELETE")}},SMTP:{get:function(){return query("/smtp/","GET")},post:function(e){return query("/smtp/","POST",e)}},SMTPId:{get:function(e){return query("/smtp/"+e,"GET")},put:function(e){return query("/smtp/"+e.id,"PUT",e)},delete:function(e){return query("/smtp/"+e,"DELETE")}},SMS:{get:function(){return query("/sms/","GET")},post:function(e){return query("/sms/","POST",e)}},SMSId:{get:function(e){return query("/sms/"+e,"GET")},put:function(e){return query("/sms/"+e.id,"PUT",e)},delete:function(e){return query("/sms/"+e,"DELETE")}},IMAP:{get:function(){return query("/imap/","GET",{},!1)},post:function(e){return query("/imap/","POST",e,!1)},validate:function(e){return query("/imap/validate","POST",e,!0)}},users:{get:function(){return query("/users/","GET")},post:function(e){return query("/users/","POST",e,!0)}},userId:{get:function(e){return query("/users/"+e,"GET")},put:function(e){return query("/users/"+e.id,"PUT",e,!0)},delete:function(e){return query("/users/"+e,"DELETE")}},webhooks:{get:function(){return query("/webhooks/","GET")},post:function(e){return query("/webhooks/","POST",e)}},webhookId:{get:function(e){return query("/webhooks/"+e,"GET")},put:function(e){return query("/webhooks/"+e.id,"PUT",e,!0)},delete:function(e){return query("/webhooks/"+e,"DELETE")},ping:function(e){return query("/webhooks/"+e+"/validate","POST")}},import_email:function(e){return query("/import/email","POST",e).done((function(){pollActiveJobs()}))},clone_site:function(e){return query("/import/site","POST",e).done((function(){pollActiveJobs()}))},send_test_email:function(e){return query("/util/send_test_email","POST",e,!0)},send_test_sms:function(e){return query("/util/send_test_sms","POST",e,!0)}};window.api=api;var jobPollInterval=null;function pollActiveJobs(){$.ajax({url:"/api/import/jobs/active",method:"GET",success:function(e){if(e&&e.length>0){var t=e[0],n=parseInt(t.processed)||0,r=parseInt(t.total)||0,o=0;r>0&&(o=Math.round(n/r*100)),$("#global-job-processed").text(n.toLocaleString()),$("#global-job-total").text(r>0?r.toLocaleString():"?"),$("#global-job-percent").text(o+"%"),$("#global-job-bar").css("width",o+"%"),$("#global-progress-container").show(),$("#view-import-details").data("job-id",t.id),jobPollInterval||resetJobPolling(2e3)}else $("#global-progress-container").hide(),jobPollInterval&&(console.log("No active jobs. Stopping background poller."),clearInterval(jobPollInterval),jobPollInterval=null)},error:function(e){401===e.status&&(console.warn("Active job polling: Unauthorized. Stopping poll."),jobPollInterval&&(clearInterval(jobPollInterval),jobPollInterval=null))}})}function resetJobPolling(e){jobPollInterval&&clearInterval(jobPollInterval),jobPollInterval=setInterval(pollActiveJobs,e)}function viewJobDetails(e){if("function"==typeof pollJob)pollJob(e);else{Swal.fire({title:"Import Progress",html:'<div style="margin-bottom:10px;">Progress: <span id="job-percent" style="font-weight:bold; font-size:1.2em;">0%</span></div><div class="progress" style="margin-bottom:15px; height: 20px;">  <div id="job-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="width: 0%"></div></div><div style="margin-bottom:10px;">  Processed: <span id="job-processed">0</span> / <span id="job-total">0</span><br>  Status: <span id="job-status">Processing</span></div>',allowOutsideClick:!1,showConfirmButton:!0,confirmButtonText:"Run in Background",showCancelButton:!0,cancelButtonText:"Cancel Import",cancelButtonColor:"#d33"}).then((t=>{t.dismiss===Swal.DismissReason.cancel&&$.ajax({url:"/api/import/job/"+e+"/cancel",type:"POST",success:function(){successFlash("Import cancellation requested"),$("#global-progress-container").hide(),"/groups"===location.pathname&&setTimeout((function(){"function"==typeof load?load():location.reload()}),1e3)}})}));var t=setInterval((function(){Swal.isVisible()?$.get("/api/import/job/"+e,(function(e){var n=parseInt(e.processed)||0,r=parseInt(e.total)||0,o=0;r>0&&(o=Math.round(n/r*100)),$("#job-processed").text(n.toLocaleString()),$("#job-total").text(r>0?r.toLocaleString():"?"),$("#job-status").text(e.status),$("#job-percent").text(o+"%"),$("#job-bar").css("width",o+"%"),"completed"!==e.status&&"failed"!==e.status&&"cancelled"!==e.status||(clearInterval(t),Swal.fire({title:"Import "+(e.status.charAt(0).toUpperCase()+e.status.slice(1)),text:e.result||(e.errors?e.errors.join("\n"):""),icon:"completed"===e.status?"success":"cancelled"===e.status?"warning":"error"}).then((()=>{"/groups"===location.pathname&&("function"==typeof load?load():location.reload())})))})):clearInterval(t)}),1e3)}}$(document).ready((function(){var e=location.pathname;$(".nav-sidebar li").each((function(){var t=$(this);t.find("a").attr("href")===e&&t.addClass("active")})),$.fn.dataTable.moment("MMMM Do YYYY, h:mm:ss a"),$('[data-toggle="tooltip"]').tooltip(),pollActiveJobs(),$("#view-import-details").click((function(){var e=$(this).data("job-id");e&&viewJobDetails(e)}))}));