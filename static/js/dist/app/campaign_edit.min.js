var page={};function save(){page.name=$("#name").val();var e=CKEDITOR.instances.html_editor;page.html=e.getData(),page.capture_credentials=$("#capture_credentials_checkbox").prop("checked"),page.capture_passwords=$("#capture_passwords_checkbox").prop("checked"),page.redirect_url=$("#redirect_url_input").val(),(page.id?api.pageId.put(page):api.pages.post(page)).done((function(e){Swal.fire({title:"Success!",text:"Page saved successfully!",type:"success"}).then((function(){location.href="/landing_pages"}))})).fail((function(e){var r="An error occurred";e.responseJSON&&e.responseJSON.message?r=e.responseJSON.message:e.responseText&&(r=e.responseText),Swal.fire("Error",r,"error")}))}function importSite(){var e=$("#url").val();e?api.clone_site({url:e,include_resources:!1}).done((function(e){$("#html_editor").val(e.html),CKEDITOR.instances.html_editor.setData(e.html),$("#importSiteModal").modal("hide")})).fail((function(e){var r="An error occurred";e.responseJSON&&e.responseJSON.message&&(r=e.responseJSON.message),Swal.fire("Error",r,"error")})):Swal.fire("Error","No URL Specified!","error")}$(document).ready((function(){$("#html_editor").ckeditor(),"function"==typeof setupAutocomplete&&setupAutocomplete(CKEDITOR.instances.html_editor),$("#capture_credentials_checkbox").change((function(){$("#capture_passwords").toggle(),$("#redirect_url").toggle()})),$("#submitButton").click(save),$("#importSubmitButton").click(importSite);var e=window.location.pathname.split("/").pop(),r=function(e){var r,t,a=window.location.search.substring(1).split("&");for(t=0;t<a.length;t++)if((r=a[t].split("="))[0]===e)return void 0===r[1]||decodeURIComponent(r[1]);return!1}("copy");e&&!isNaN(e)?($("#pageTitle").text("Edit Landing Page"),api.pageId.get(e).done((function(e){page=e,$("#name").val(page.name),$("#html_editor").val(page.html),CKEDITOR.instances.html_editor.setData(page.html),$("#capture_credentials_checkbox").prop("checked",page.capture_credentials).change(),$("#capture_passwords_checkbox").prop("checked",page.capture_passwords),$("#redirect_url_input").val(page.redirect_url)})).fail((function(){Swal.fire("Error","Error fetching page data","error")}))):r&&($("#pageTitle").text("Copy Landing Page"),api.pageId.get(r).done((function(e){$("#name").val("Copy of "+e.name),$("#html_editor").val(e.html),CKEDITOR.instances.html_editor.setData(e.html),$("#capture_credentials_checkbox").prop("checked",e.capture_credentials).change(),$("#capture_passwords_checkbox").prop("checked",e.capture_passwords),$("#redirect_url_input").val(e.redirect_url)})).fail((function(){Swal.fire("Error","Error fetching page data for copy","error")})))}));
