var templates=[],templateType="";function switchTemplateType(e){templateType=e,""==e?(pageHeader="All Templates",$(".page-header").text(pageHeader)):"email"==e?(pageHeader="Email Templates",$(".page-header").text(pageHeader)):"sms"==e?(pageHeader="SMS Templates",$(".page-header").text(pageHeader)):"qr"==e&&(pageHeader="QR Templates",$(".page-header").text(pageHeader)),$("#emptyMessageText").text("No "+templateType+" templates created yet. Let's create one!"),load()}function edit(e){location.href=-1==e?"/template":"/template/"+templates[e].id}function copy(e){location.href="/template?copy="+templates[e].id}function deleteTemplate(e){Swal.fire({title:"Are you sure?",text:"This will delete the template. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete "+escapeHtml(templates[e].name),confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise((function(t,a){api.templateId.delete(templates[e].id).done((function(e){t(e)})).fail((function(e){var a="An error occurred";e.responseJSON&&e.responseJSON.message?a=e.responseJSON.message:e.responseText&&(a=e.responseText),Swal.showValidationMessage(a),t(!1)}))}))}}).then((function(e){e.value&&Swal.fire("Template Deleted!","This template has been deleted!","success"),$('button:contains("OK")').on("click",(function(){location.reload()}))}))}function load(){$("#templateTable").hide(),$("#emptyMessage").hide(),$("#loading").show();api.templates.get().done((function(e){templates=e,""==templateType?"label-primary":"sms"==templateType?(templates=templates.filter((e=>"sms"==e.type)),"label-primary"):"qr"==templateType?(templates=templates.filter((e=>"qr"==e.type)),"label-info"):(templates=templates.filter((e=>!e.type||"email"==e.type)),"label-primary"),$("#loading").hide(),templates.length>0?($("#templateTable").show(),templateTable=$("#templateTable").DataTable({destroy:!0,columnDefs:[{orderable:!1,targets:"no-sort"}]}),templateTable.clear(),templateRows=[],$.each(templates,(function(e,t){var a="label-default",l=t.type||"email";"qr"==l?a="label label-primary":"email"==l?a="label-success":"sms"==l&&(a="label-info"),templateRows.push(["<input type='checkbox' class='template-checkbox' value='"+t.id+"'>",escapeHtml(t.name),"<span class='label "+a+"'>"+(t.type||"EMAIL").toUpperCase()+"</span>",escapeHtml(t.created_by||""),moment(t.modified_date).format("MMMM Do YYYY, h:mm:ss a"),"<div class='pull-right'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Edit Template' onclick='edit("+e+")'>                    <i class='fa fa-pencil'></i>                    </button>\t\t    <button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Copy Template' onclick='copy("+e+")'>                    <i class='fa fa-copy'></i>                    </button>                    <button class='btn btn-danger' data-toggle='tooltip' data-placement='left' title='Delete Template' onclick='deleteTemplate("+e+")'>                    <i class='fa fa-trash-o'></i>                    </button></div>"])})),templateTable.rows.add(templateRows).draw(),$('[data-toggle="tooltip"]').tooltip()):$("#emptyMessage").show()})).fail((function(){$("#loading").hide(),errorFlash("Error fetching templates")}))}function toggleSelectAll(){var e=$("#selectAllTemplates").is(":checked");$(".template-checkbox").prop("checked",e)}function bulkDeleteSelected(){var e=[];$(".template-checkbox:checked").each((function(){e.push($(this).val())})),0!==e.length?Swal.fire({title:"Delete "+e.length+" templates?",text:"This action cannot be undone!",type:"warning",showCancelButton:!0,confirmButtonText:"Delete",confirmButtonColor:"#d9534f",reverseButtons:!0}).then((function(t){if(t.value){Swal.fire({title:"Deleting...",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}});var a=e.map((e=>api.templateId.delete(e)));$.when.apply($,a).then((function(){Swal.fire("Deleted!","The selected templates have been removed.","success").then((()=>{location.reload()}))})).fail((function(){Swal.fire("Error","Some templates could not be deleted.","error").then((()=>{location.reload()}))}))}})):Swal.fire("No selection","Please select at least one template to delete.","info")}$(document).ready((function(){switchTemplateType(""),-1!==window.location.pathname.indexOf("sms")?templateType="sms":-1!==window.location.pathname.indexOf("qr")&&(templateType="qr"),$("#type_"+templateType).parent().addClass("active")}));