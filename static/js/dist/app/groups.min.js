var groups=[],profileType="";function switchProfileType(e){profileType=e,""==e?(pageHeader="All Groups",$(".page-header").text(pageHeader)):"email"==e?(pageHeader="Email Groups",$(".page-header").text(pageHeader)):"sms"==e&&(pageHeader="SMS Groups",$(".page-header").text(pageHeader)),$("#emptyMessageText").text("No "+profileType+" profiles created yet. Let's create one!"),load()}function edit(e){location.href=-1==e?"/group":"/group/"+e}var deleteGroup=function(e){var o=groups.find((function(o){return o.id===e}));o&&Swal.fire({title:"Are you sure?",text:"This will delete the group. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete "+escapeHtml(o.name),confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise((function(o,t){api.groupId.delete(e).done((function(e){o(e)})).fail((function(e){var t="An error occurred";e.responseJSON&&e.responseJSON.message?t=e.responseJSON.message:e.responseText&&(t=e.responseText),Swal.showValidationMessage(t),o(!1)}))}))}}).then((function(e){e.value&&Swal.fire("Group Deleted!","This group has been deleted!","success"),$('button:contains("OK")').on("click",(function(){location.reload()}))}))};function load(){$("#groupTable").hide(),$("#emptyMessage").hide(),$("#loading").show(),api.groups.summary().done((function(e){if($("#loading").hide(),e.total>0){groups=e.groups,$("#emptyMessage").hide(),$("#groupTable").show(),"sms"==profileType?(groups=groups.filter((e=>"sms"==e.group_type)),labelClass="label-primary"):"email"==profileType&&(groups=groups.filter((e=>"email"==e.group_type)),labelClass="label-success");var o=[];$.each(groups,(function(e,t){var a="label-default";"email"==t.group_type||"qr"==t.group_type?a="label-success":"sms"==t.group_type&&(a="label-info");var r="<span class='label "+a+"'>"+(t.group_type||"email").toUpperCase()+"</span>";o.push(["true"===window.modifySystem?"<input type='checkbox' class='group-checkbox' value='"+t.id+"'>":"",escapeHtml(t.name),r,escapeHtml(t.created_by||""),escapeHtml(t.num_targets),moment(t.modified_date).format("MMMM Do YYYY, h:mm:ss a"),"true"===window.modifySystem?"<button class='btn btn-primary' onclick='edit("+t.id+")'>                    <i class='fa fa-pencil'></i>                    </button>                    <button class='btn btn-danger' onclick='deleteGroup("+t.id+")'>                    <i class='fa fa-trash-o'></i>                    </button>":""])})),$("#groupTable").DataTable({destroy:!0,columnDefs:[{orderable:!1,targets:"no-sort"}],data:o})}else $("#emptyMessage").show()})).fail((function(){errorFlash("Error fetching groups")}))}function toggleSelectAll(){var e=$("#selectAllGroups").is(":checked");$(".group-checkbox").prop("checked",e)}function bulkDeleteSelected(){var e=[];$(".group-checkbox:checked").each((function(){e.push($(this).val())})),0!==e.length?Swal.fire({title:"Delete "+e.length+" groups?",text:"This action cannot be undone!",type:"warning",showCancelButton:!0,confirmButtonText:"Delete",confirmButtonColor:"#d9534f",reverseButtons:!0}).then((function(o){if(o.value){Swal.fire({title:"Deleting...",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}});var t=e.map((e=>api.groupId.delete(e)));$.when.apply($,t).then((function(){Swal.fire("Deleted!","The selected groups have been removed.","success").then((()=>{location.reload()}))})).fail((function(){Swal.fire("Error","Some groups could not be deleted.","error").then((()=>{location.reload()}))}))}})):Swal.fire("No selection","Please select at least one group to delete.","info")}$(document).ready((function(){switchProfileType("")}));