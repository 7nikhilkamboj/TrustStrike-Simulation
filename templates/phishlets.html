{{define "body"}}
{{template "nav" .}}
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <div class="row">
        <h1 class="page-header">Phishlet Management</h1>
    </div>
    <div id="flashes" class="row">
        {{template "flashes" .Flashes}}
    </div>

    <!-- Create Phishlet Button -->
    <div class="row" style="margin-bottom: 20px;">
        <div class="col-md-12">
            <button class="btn btn-primary" data-toggle="modal" data-target="#createPhishletModal"
                onclick="resetPhishletForm()">
                <i class="fa fa-plus"></i> Create New Phishlet
            </button>
        </div>
    </div>

    <!-- Phishlets List -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Phishlets</h3>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <input type="text" class="form-control" id="searchPhishlets" placeholder="Search phishlets...">
                    </div>
                    <table class="table table-striped table-hover" id="phishletsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Author</th>
                                <th>Min Version</th>
                                <th>Landing Domain</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="phishletsTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Phishlet Modal -->
<div class="modal fade" id="createPhishletModal" tabindex="-1" role="dialog" aria-labelledby="phishletModalTitle">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="phishletModalTitle">Create New Phishlet</h4>
            </div>
            <div class="modal-body">
                <form id="phishletForm">
                    <input type="hidden" id="phishletEditMode" value="create">

                    <!-- Basic Info -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="phishletName">Name</label>
                                <input type="text" class="form-control" id="phishletName" placeholder="e.g., myservice">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="phishletAuthor">Author</label>
                                <input type="text" class="form-control" id="phishletAuthor" placeholder="Author Name">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="phishletMinVer">Min Version</label>
                                <input type="text" class="form-control" id="phishletMinVer" value="3.3.0">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="phishletLandingDomain">Landing Domain</label>
                                <input type="text" class="form-control" id="phishletLandingDomain"
                                    placeholder="e.g., example.com">
                            </div>
                        </div>
                    </div>

                    <hr>
                    <h4>Login Configuration</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="loginDomain">Login Domain</label>
                                <input type="text" class="form-control" id="loginDomain"
                                    placeholder="login.example.com">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="loginPath">Login Path</label>
                                <input type="text" class="form-control" id="loginPath" value="/">
                            </div>
                        </div>
                    </div>

                    <hr>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h4 style="margin: 0;">Proxy Hosts</h4>
                        <button type="button" class="btn btn-sm btn-success" onclick="addProxyHost({})"><i
                                class="fa fa-plus"></i> Add Host</button>
                    </div>
                    <div id="proxyHostsList" style="margin-top: 10px;">
                        <!-- Proxy Hosts items -->
                    </div>

                    <hr>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h4 style="margin: 0;">Auth Tokens</h4>
                        <button type="button" class="btn btn-sm btn-success" onclick="addAuthToken({})"><i
                                class="fa fa-plus"></i> Add Token</button>
                    </div>
                    <div id="authTokensList" style="margin-top: 10px;">
                        <!-- Auth Tokens items -->
                    </div>

                    <hr>
                    <h4>Credentials Capture</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">Username</div>
                                <div class="panel-body">
                                    <div class="form-group">
                                        <label>Key</label>
                                        <input type="text" class="form-control" id="credUsernameKey"
                                            placeholder="email">
                                    </div>
                                    <div class="form-group">
                                        <label>Search Pattern</label>
                                        <input type="text" class="form-control" id="credUsernameSearch" value="(.*)">
                                    </div>
                                    <div class="form-group">
                                        <label>Type</label>
                                        <select class="form-control" id="credUsernameType">
                                            <option value="post">POST</option>
                                            <option value="json">JSON</option>
                                            <option value="query">Query</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">Password</div>
                                <div class="panel-body">
                                    <div class="form-group">
                                        <label>Key</label>
                                        <input type="text" class="form-control" id="credPasswordKey"
                                            placeholder="password">
                                    </div>
                                    <div class="form-group">
                                        <label>Search Pattern</label>
                                        <input type="text" class="form-control" id="credPasswordSearch" value="(.*)">
                                    </div>
                                    <div class="form-group">
                                        <label>Type</label>
                                        <select class="form-control" id="credPasswordType">
                                            <option value="post">POST</option>
                                            <option value="json">JSON</option>
                                            <option value="query">Query</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="savePhishlet()">Save Phishlet</button>
            </div>
        </div>
    </div>
</div>

<!-- View Config Modal -->
<div class="modal fade" id="viewConfigModal" tabindex="-1" role="dialog" aria-labelledby="viewConfigModalTitle">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="viewConfigModalTitle">Phishlet Configuration</h4>
            </div>
            <div class="modal-body">
                <pre id="configDisplay"
                    style="background: #f5f5f5; padding: 15px; border-radius: 4px; max-height: 500px; overflow-y: auto;"></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{{end}}

{{define "scripts"}}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="/js/dist/app/phishlets.min.js"></script>
{{end}}